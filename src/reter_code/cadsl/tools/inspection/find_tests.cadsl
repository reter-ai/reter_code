# find_tests - Find test classes/functions for a module, class, or function
#
# Returns test coverage information for the specified target.
# Uses REQL pattern matching to find tests related to specific targets.

query find_tests() {
    """Find test classes/functions for a module, class, or function."""

    param target: str = "";
    param module: str = "";
    param limit: int = 100;

    # Get all tests - filter by target if provided using CONTAINS
    reql {
        SELECT ?t ?test_name ?file ?line
        WHERE {
            ?t type function .
            ?t has-name ?test_name .
            ?t is-in-file ?file .
            ?t is-at-line ?line .
            FILTER(REGEX(?test_name, "^test_|^Test|_test$"))
        }
        ORDER BY ?file ?line
        LIMIT 1000
    }
    | select { test_name, file, line, qualified_name: t }
    | map {
        test_name: test_name,
        file: file,
        line: line,
        qualified_name: qualified_name
    }
    | emit { tests_found }
}
